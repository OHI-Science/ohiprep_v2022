---
title: "Sara_Explore_OHI_scores"
output: html_document
---


```{r setup, include=FALSE}
## loading packages
library(dplyr)
library(tidyr)
library(tidyverse)

source("http://ohi-science.org/ohiprep_v2020/workflow/R/common.R")
```


## OH NO!
While you are working at your computer at NCEAS, you receive a frantic call from someone working on an OHI project:

THEY NEED HELP!

"No problem" you say, "I'll get Julie or Melanie or Gage"...but they are no where to be found!

"Hold on, I'll get Jamie or Casey or Courtney"...but they are also gone.

It is clearly going to be up to you to save the day!!

## You've got this!

Please help them answer the following questions.  You will work from this document, using the code chunks as a work space to work explore the data. Do NOT bother keeping the code chunks neat and organized, we want to see your work process in all its messy glory.  However, I DO recommend including plenty of comments, mostly because I have found this helps me organize my thoughts.   

You can ask us any questions along the way (slack or issues)!

Good luck!

## Questions

### Getting the data

*Goal* Read the latest OHI global data into the R working space (call the data object "scores").

*Hint* Here is a link to the data: 
https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/scores.csv

```{r, include=FALSE}
## Working space

scores <- read.csv("https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/scores.csv")

```

### Region explore

*Question* Why are there N=222 regions (see code below)...aren't there supposed to be 220?

*Hint 1* Here is a link to the official region list: https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/spatial/regions_list.csv

*Hint 2* Which region has all NA values for scores?

*Answer* One of the regions has an ID of 0, which isn't listed as an official region on the region list. Region 213, Antarctica, has all NA values for scores because it is not included in the global assessment.  

```{r, include=FALSE}
## Working space

length(unique(scores$region_id))

# Find which region has NA values for every score:
find_na <- scores %>% 
  filter(is.na(score)) %>% 
  group_by(region_id) %>% 
  summarize(number_na = length(region_id)) %>% #find how many NA values each region has
  arrange(number_na) #arrange by highest number of NAs

#Region 213 has all NA values - this is Antarctica which is not included in the global assessment
```

*Question* Which region id corresponds to the United States?  
*Answer* The United States is region 163  

### Goal explore

*Question * When I look at the number of goals, N=19 show up....I thought there were supposed to be 10 goals!!! Can you explain what all these are? Also, why do some of the goal abbreviations have 2 letters and others 3 letters?  

*Hint 1* Review the methods doc here: https://raw.githack.com/OHI-Science/ohi-global/published/documents/methods/Supplement.html

*Answer* The 10 main goals have 2 letter abbreviations and the subgoals have 3 letter abbreviations. The 10 main goals plus 8 subgoals are:  
 
 - AO: Artisinal Fishing Opportunity    
 - BD: Biodiversity  
   *Subgoals*  
   - HAB: Habitat  
   - SPP: Species  
 - CS: Carbon Storage  
 - CW: Clean Water  
 - LE: Coastal Livelihoods and Economies  
    *Subgoals*  
   - LIV: Livelihoods    
   - ECO: Economies  
 - CP: Coastal Protection  
 - FP: Food Provision  
    *Subgoals* 
   - FIS: Fisheries    
   - MAR: Mariculture  
 - NP: Natural Products  
 - SP: Sense of Place  
    *Subgoals*  
   - ICO: Iconic Species   
   - LSP: Lasting Special Places  
 - TR: Tourism and Recreation  
 
Index is the 19th goal. This isn't actually a goal, but rather reflects the overall average of all the goals for a specific region.    

```{r, include=FALSE}
## Working space

unique(scores$goal)

```


### Dimension explore

*Question* There are 6 dimensions reported in this dataset (future, pressures, resilience, score, status, and trend).  When I look at the number of records in each of these categories, I notice that there are more "score" values reported than "status" values (see working space below). Given that scores are calculated using status, it seems like these should have the same number of records. Can you figure out what is going on here. Is something going wrong?  

*Answer* Region 0 is included in the future and score because it reflects the global average of status, likely future status, and the scores for all the regions. However, it doesn't have any records for pressures, resilience or status because those are the factors that are used to calculate the likely future status and they are country specific. Since there are no global averages for these categories, there are no records in Region 0.   

```{r, include=FALSE}
## Working space

unique(scores$dimension) #there are 6 unique dimensions
table(scores$dimension) #pressure/resilience/trend all have same records, future and score have same (but more)

table(scores$goal) #all the goals and subgoals have the same records except the index
table(scores$goal, scores$dimension)

# ok...but why are the different values for pressures/resilience/trend and future?
# addition of region 0!
ao <- filter(scores, goal=="AO")
table(scores$region_id, scores$dimension)
```


### Missing data

*Question* Figure out which goals/subgoals have the most NA values for scores in 2019.  Which ones have the least?  Can you discern any reason why some goals have lots of missing values and others do not?

*Hint* Include only dimension = score, and year = 2019, and cut region_id = 0.

*Answer* Natural Products (NP) has the highest number of NA values. This may be because the products OHI includes within this goal aren't produced everywhere in the world or countries produced some other commodities that are not included within the six commodity categories included in this goal.   

```{r, include=FALSE}
## Working space

# Find number of NAs for each goal - include only scores from year 2019 and exclude region 0
na_data <- scores %>% 
  filter(dimension == "score") %>%
  filter(region_id != 0) %>%
  filter(year == 2019) %>% 
  group_by(goal) %>% 
  summarize(number_na = length(score[is.na(score)])) %>% #find the number of NAs
  arrange(-number_na) #arrange from high to low


```


### Scores

*Question* If we have a goal with a future status of 80 and status of 90...what is the score?  

*Hint* Isolate the future, status, and score values for one region and one goal and see if you can identify a pattern.

*Answer* The score would be 85. The score is the average of the future status and the current status.  

```{r, include=FALSE}
## Working space
pattern_score <- scores %>% 
  filter(goal == "AO") %>% #isolate one goal
  filter(region_id == 18) %>%  #choose a region Fiji
  filter(dimension == "future" | dimension == "status" | dimension == "score") %>% #isolate dimensions
  filter(year == 2018) #score is the average
  
# Find the score using the average of status and future
score <- (80 + 90)/2
```


### Metadata

*Project* Based on your data exploration and other resources, provide some metadata that describes each variable.  Write it so it would be useful to you in the future as you are looking through these data.

Write it in the following table.  NOTE: Knit the document to see if the table is formatting correctly (but don't bother if you do not know how to knit a document or if you are running into errors!).

Variable   | Description                  | Values
---------- | ---------------------------- | ------------------------------
goal       |  Abbreviation for goal (2 letter) or subgoal (3 letter) | AO, BD (HAB, SPP), CS, CW, LE (LIV, ECO), CP, FP (FIS, MAR), NP, SP (ICO, LSP), TR
dimension  |  Variables used to calculate goal and subgoal scores | resilience, pressures, trend (all used to calculate future), future (likely future status), status (current status), score (overall score)
region_id  |  Unique numeric region code   | 0 - 250
score      |  Score corresponding to each dimension for each goal | trend scores -1 to 1; all others 0-100          
year       |  Scenario year               | 2012 to 2020 


```{r, include=FALSE}
## Working space

summary(scores)

```


### Plot

*Project* Create a scatterplot that compares 2012 and 2019 *scores* for each region for the artisanal opportunities goal. Based on this, do scores for the artisanal opportunities goal appear to have increased or decreased over time? 

*Answer* In general, it appears the AO scores have increased from 2012 to 2019. While there were a number of regions exhibiting lower scores in 2019 compared to 2012, a majority of regions had better scores in 2019 compared to 2012. About 8 regions exhibited no change in score from 2012 to 2019.  

```{r, include=FALSE}
## Working space

#wrangle the data:
ao <- scores %>% 
  filter(goal == "AO") %>% #isolate artisinal opportunities goal
  filter(year == 2012 | year == 2019) %>% #compare year 2012 to 2019
  filter(region_id != 0) %>% #filter out region 0 (global average)
  filter(dimension == "score") %>%  #isolate the score dimension
  select(-goal, -dimension) %>% 
  spread(year,score) %>% #get each year as a different column so scores can be compared
  rename("score_2012" = "2012",
         "score_2019" = "2019") %>% #rename so numbers aren't the column name
  mutate(ao_diff = score_2019 - score_2012) #find the difference in scores between 2019 and 2012


#plot:
ao_plot <- ggplot(ao, aes(x = ao_diff, y = region_id)) +
  geom_point(color = case_when(ao$ao_diff > 0 ~ "forestgreen",
                               ao$ao_diff < 0 ~ "firebrick4",
                               ao$ao_diff == 0 ~ "grey12"), alpha = 0.8) + 
  geom_vline(xintercept = 0, color = "black") +
  scale_x_continuous(expand = c(0,0), limits = c(-10,15)) + 
  scale_y_continuous(expand = c(0.01,0.01), limits = c(0,251)) + 
  labs(x = "Score Difference", y = "Region ID",
       title = "Difference in Artisinal Fishing Opportunity Scores",
       subtitle = "2012 to 2019") +
  theme_bw()
  

ao_plot


```
