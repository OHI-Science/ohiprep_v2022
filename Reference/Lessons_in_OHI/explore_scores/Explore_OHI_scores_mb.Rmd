---
title: "Learning about OHI scores"
output: html_document
---

```{r setup, include=FALSE}
#call ohi specific functions


## loading packages
library(dplyr)
library(tidyr)
library(tidyverse)

```


## OH NO!
While you are working at your computer at NCEAS, you receive a frantic call from someone working on an OHI project:

THEY NEED HELP!

"No problem" you say, "I'll get Julie or Melanie or Gage"...but they are no where to be found!

"Hold on, I'll get Jamie or Casey or Courtney"...but they are also gone.

It is clearly going to be up to you to save the day!!

## You've got this!

Please help them answer the following questions.  You will work from this document, using the code chunks as a work space to work explore the data. Do NOT bother keeping the code chunks neat and organized, we want to see your work process in all its messy glory.  However, I DO recommend including plenty of comments, mostly because I have found this helps me organize my thoughts.   

You can ask us any questions along the way (slack or issues)!

Good luck!

## Questions

### Getting the data

*Goal* Read the latest OHI global data into the R working space (call the data object "scores").

*Hint* Here is a link to the data: 
https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/scores.csv

```{r, include=FALSE}
## Working space

scores <- read.csv("https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/scores.csv")

```

### Region explore

*Question* Why are there N=222 regions (see code below)...aren't there supposed to be 220?

*Hint 1* Here is a link to the official region list: https://raw.githubusercontent.com/OHI-Science/ohi-global/draft/eez/spatial/regions_list.csv

*Hint 2* Which region has all NA values for scores?

*Answer* Write your answer here!

There are two extra, one is region zero and one is 213, which is Antartica. Region zero is the overall aggregated score, and region 213 is not included in the global assessment. 

```{r, include=FALSE}
## Working space

length(unique(scores$region_id))

scores_na <- scores %>% 
  group_by(region_id) %>% 
  summarize(
    na = length(is.na(score))
  ) %>% 
  arrange(-na)


scores_na

```

*Question* Which region id corresponds to the United States?

163

### Goal explore

*Question * When I look at the number of goals, N=19 show up....I thought there were supposed to be 10 goals!!! Can you explain what all these are? Also, why do some of the goal abbreviations have 2 letters and others 3 letters?  

*Hint 1* Review the methods doc here: https://raw.githack.com/OHI-Science/ohi-global/published/documents/methods/Supplement.html

*Answer* Write your answer here!

There are 10 goals, however for four of those goals there are 2 subgoals that are also calculated. The subgoals have three letter abbreviations, while the larger goals have two letter abbreviations. The last goal listed here, index, is the overall weighted score of all the goals for that region. 

```{r, include=FALSE}
## Working space

unique(scores$goal)

```


### Dimension explore

*Question* There are 6 dimensions reported in this dataset (future, pressures, resilience, score, status, and trend).  When I look at the number of records in each of these categories, I notice that there are more "score" values reported than "status" values (see working space below). Given that scores are calculated using status, it seems like these should have the same number of records. Can you figure out what is going on here. Is something going wrong?  

*Answer* Write your answer here!

The six levels of the dimension variable represent different layres of caluclating the overall goal score. `trend`, `pressures` and resilience all go into calculating the number shown in future. The `future` score is then combined with `status` to then find the over all `score`. 


```{r, include=FALSE}
## Working space

unique(scores$dimension)
table(scores$dimension)

table(scores$goal)
table(scores$goal, scores$dimension)

# ok...but why are the different values for pressures/resilience/trend and future?
#pressures, resilience, trend all go into calculating 

# addition of region 0!
ao <- filter(scores, goal=="AO")
table(scores$region_id, scores$dimension)
```

This table is showing that there are more future values than there are status values bevcause of the "index" goal which is the global average, which does not have a pressure, resilience or future score. 

### Missing data

*Question* Figure out which goals/subgoals have the most NA values for scores in 2019.  Which ones have the least?  Can you discern any reason why some goals have lots of missing values and others do not?

*Hint* Include only dimension = score, and year = 2019, and cut region_id = 0.

*Answer* Write your answer here!

The goal with the most NAs are natural products - this may be because certain regions have more species that are commercially valuable than others. For example, tropical regions tend to have more shells and other species that people value as decorative pieces. 

Carbon storage also has a lot of NAs, which seems difficult to calculate and would need detailed global data.

```{r, include=FALSE}
## Working space

na_data <- scores %>% 
  filter(dimension == "score") %>%
  filter(region_id != 0) %>%
  filter(year == 2019) %>% 
  group_by(goal) %>% 
  summarise(
    na = length(score[is.na(score)])
  ) %>% 
  arrange(na)

na_data

```


### Scores

*Question* If we have a goal with a future status of 80 and status of 90...what is the score?  

*Hint* Isolate the future, status, and score values for one region and one goal and see if you can identify a pattern.

*Answer* Write your answer here!

The number in `score` is the average between the status and the future scores. 
```{r, include=FALSE}
## Working space

future_score <- scores %>% 
  filter(region_id == 1) %>% 
  filter(goal == "BD") %>%
  filter(dimension == "future" | dimension == "status" | dimension == "score")

```


### Metadata

*Project* Based on your data exploration and other resources, provide some metadata that describes each variable.  Write it so it would be useful to you in the future as you are looking through these data.

Write it in the following table.  NOTE: Knit the document to see if the table is formatting correctly (but don't bother if you do not know how to knit a document or if you are running into errors!).

Variable   | Description                  | Values
---------- | ---------------------------- | ------------------------------
goal       | The characters in the goal column indicate all the goals and subgoals from the OHI framework. The 10 main goals are abbreviated in with two letters, while subgoals are abbreviated in three letters                              | AO, BD, CS, CW, LE, CP, FP, NP, SP, TR, HAB, SPP, LIV, ECO, FIS, MAR, ICO, LSP
dimension  |  A character string indicating which dimension has been calculated. Trends, pressure and resilience scores are all aggregated to calculate the future. Future and status are then averaged to find the total score                            | trend, pressure, future, resilience, status, score
region_id  | An integer corresponding to a specific coastal region for which scores are calculated.                             | 0 to 222
score      | A numeric value indicating the calculated score, which are all on a scale of 0 to 100, except the trend dimension, which is scored on a scale of -1 to 1                               | -1 to 1 for trend, all else 0 to 100,          
year       |  Scenario year               | 2012 to 2019 


```{r, include=FALSE}
## Working space

summary(scores)

```


### Plot

*Project* Create a scatterplot that compares 2012 and 2019 *scores* for each region for the artisanal opportunities goal. Based on this, do scores for the artisanal opportunities goal appear to have increased or decreased over time? 

*Answer* Write your answer here!

There appears to be more positive points than negative points on the graph, suggesting that the scores for AO have generally increased rather than decreased between 2012 and 2019.  

```{r, include=FALSE}
## Working space

scatter_data <- scores %>% 
  filter(goal == "AO") %>% 
  filter(dimension == "score") %>% 
  filter(year == 2012 | year == 2019) %>% 
  spread(year, score) %>% 
  mutate(
    diff = `2019` - `2012`
  )

scatter_12_19 <- ggplot(scatter_data, aes(x = region_id, y = diff))+ 
  geom_point(color = ifelse(scatter_data$diff > 0, "aquamarine3", "tomato"))+
  theme_bw()+
  geom_hline(yintercept = 0)+
  labs(x = "Region", y = "Difference in scores between 2012 and 2019")

scatter_12_19
```

